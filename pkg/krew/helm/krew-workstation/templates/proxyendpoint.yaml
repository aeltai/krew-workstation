# Register the krew-workstation backend with Rancher's meta proxy allow list (ProxyEndpoint).
# This lets the UI extension call /meta/proxy/krew-workstation.krew-workstation.svc:3000/api/...
# without manual Settings configuration. Same mechanism as node-driver / UI extensions.
{{- if index (default dict .Values.metaProxy) "enabled" | default true }}
apiVersion: management.cattle.io/v3
kind: ProxyEndpoint
metadata:
  name: {{ include "krew-workstation.fullname" . }}
  labels:
    {{- include "krew-workstation.labels" . | nindent 4 }}
spec:
  routes:
    - domain: {{ index (default dict .Values.metaProxy) "backendHost" | default (printf "%s.%s.svc" (include "krew-workstation.fullname" .) .Release.Namespace) | quote }}
{{- end }}
